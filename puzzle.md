`대사함수.자바스크립트`

가져오기 { 세상 } "@마인크래프트/서버" 로부터;
가져오기 { 대사데이터, 캐릭터색깔지도 } "./대사데이터.자바스크립트" 로부터;

/**
 * dialogFunction은 플레이어가 특정 태그를 가지고 있을 때,
 * 그 태그에 맞는 대사 데이터를 불러와 처리하는 함수입니다.
 * 발판을 밟으면 대사데이터에 정의된 대사를 플레이어에게 보여줍니다.
 * 태그 형식은 반드시 `dialog_<씬이름>_<번호>` 여야 합니다.
 */
내보내기 함수 대사함수() {
    모든 플레이어 in 세상.모든플레이어얻기() {
        모든 태그 in 플레이어.태그얻기() {
            만약 (태그가 "dialog_"로 시작하지않으면) 계속;

            일치 = 태그.정규표현식일치(/^dialog_(.+)_(\d+)$/);
            만약 (일치가없으면) 계속;

            씬이름 = 일치[두번쨰 항목];           
            번호 = 정수로바꾸기(일치[3번째 항목]);    
            시스템번호 = 번호 - 1;      

            // 씬이 존재하는지 확인
            만약 (!(씬이름 in 대사데이터)) {
                경고출력(`대사 데이터 "${씬이름}"이 정의되어 있지 않습니다.`);
                플레이어.태그지우기(태그);
                계속;
            }

            // 번호 범위 확인
            만약 (시스템번호 < 0 또는 시스템번호 >= 대사데이터[씬이름].길이) {
                경고출력(`대사 번호 "${번호}"이 범위를 벗어났습니다. "${씬이름}" 씬의 대사는 ${대사데이터[씬이름].길이}개입니다.`);
                플레이어.태그지우기(태그);
                계속;
            }

            현재씬 = 대사데이터[씬이름][시스템번호];

            / 현재 대사(예: ["나", "안녕!"])에서
            // 첫 번째 부분은 "화자 이름", 두 번째 부분은 "대사 내용"입니다.
            // 그 중 "화자 이름"을 꺼내서 색깔을 적용합니다.
            화자이름 = 현재씬에서첫번째값;  

            화자 = 캐릭터색깔지도[화자이름]
            ? 캐릭터색깔지도[화자이름] + 화자이름 + "§f"
            : 화자이름;

            // 대사 출력
            플레이어.명령어실행비동기(`tellraw @a {"rawtext":[{"text":"${화자} : ${현재씬[1]}"}]}`);

            // 태그 제거
            플레이어.태그지우기(태그);
        }
    }
}

=================================
`대사데이터.자바스크립트`

내보내기 상수 캐릭터색깔지도 = {
    "나": "§a",
    "우진": "§a",
    "다현": "§u",
    "솔": "§e",
    "다은": "§p",
    "미스터 콜더": "§e",
    "친구": "§b",
    "???": "§8" // 알 수 없는 인물
};

/**
 * 대사 데이터 이름은 무조건 낙타표기법(카멜 케이스)으로 작성해야 합니다.
 * 태그 형식 : `dialog_<씬이름>_<번호>`
 * 리스트 형식은 `[화자, 대사]` 방식입니다.
 */
내보내기 상수 대사데이터 = {
    "프롤로그": [
        ["나", "이런 공간이 있었다니..!"],
        ["나", "애들한테 말해야겠는걸!"],
        ["나", "도대체 누가 야생에서 일주일간 살아남기라는 걸 제안했는지는 모르겠는데"],
        ["나", "그걸 제안한 애는 진짜 정신 나간 거 같아."],
        ["친구", "그러게 말이야. 기말 끝났다고 바로 이러는 애가 어디 있나고 ㅋㅋ"],
        ["친구", "근데 재미는 있을 것 같지 않아?"],
        ["나", "맞아, 한편으로는 그런 멍청한 생각을 바로 실행한다는 게 부럽기도 해."],
        ["나", "그나저나 여기에 이런 구조물 하나 있고 끝이야?"],
        ["친구", "그래? 그래도 여기는 좋은 낚시터가 될 거 같은데?"],
        ["나", "그러긴 하겠다. 근데 말이야"],
        ["친구", "왜?"],
        ["나", "이런 구조물은 왜 있는 걸까?"],
        ["나", "완전 야생에 이 구조물 하나 있는데 끝이잖아?"],
        ["나", "나만 이거 너무 이질적으로 보이는 거야?"],
        ["친구", "그렇게 말하니까 너무 무서운데"],
        ["나", "이 쫄보 자식 ㅋㅋ"],
        ["친구", "아니 그런 게 아니라. 너무 이상하게 생각하지 말라는 거지."],
        ["친구", "적어도 이 공간은 아주 많은 도움을 줄 거라고."],
        ["친구", "그건 맞지?"],
        ["나", "맞아. 마침 기말도 끝났는데."],
        ["나", "야생에서 살아남는데 이런 게 뭐 이상하겠나."],
        ["나", "지금 보니 진짜 뭐 없는 거 같다"],
        ["친구", "잠시만! 저기 문이 있어"],
        ["나", "가보자!"],
    ],
}

